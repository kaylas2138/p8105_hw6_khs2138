p8105_hw6_khs2318
================
Kayla Schiffer-Kane
2023-12-02

- [Problem 1](#problem-1)
  - [Import and Clean Homicide Data](#import-and-clean-homicide-data)
  - [GLM Baltimore](#glm-baltimore)
  - [City-wise GLM](#city-wise-glm)
  - [Plot OR and CIs](#plot-or-and-cis)

# Problem 1

The *Washington Post* has gathered data on homicides in 50 large U.S.
cities and made the data available through a GitHub repository
[here](https://github.com/washingtonpost/data-homicides). You can read
their accompanying article
[here](https://www.washingtonpost.com/graphics/2018/investigations/where-murders-go-unsolved/).

## Import and Clean Homicide Data

- Create a `city_state` variable (e.g. “Baltimore, MD”)
- Create a binary variable indicating whether the homicide is solved
- Omit cities Dallas, TX; Phoenix, AZ; and Kansas City, MO – these don’t
  report victim race.
- Also omit Tulsa, AL – this is a data entry mistake.
- Limit your analysis those for whom `victim_race` is `white` or
  `black`. Be sure that `victim_age` is numeric.

``` r
homicide_data = read_csv('./data/homicide-data.csv') |>
  janitor::clean_names() |>
  mutate(city_state = paste(city,state, sep = ", "),
         solved = as.numeric(disposition == "Closed by arrest"),
         victim_age = as.numeric(victim_age)) |>
  filter(victim_race %in% c("White","Black")) |>
  filter(!city_state %in% 
           c("Dallas, TX","Phoenix, AZ","Kansas City, MO","Tulsa, AL")) |>
  mutate(victim_race = fct_relevel(victim_race),
         victim_sex = fct_relevel(victim_sex, "Female"))
```

## GLM Baltimore

For the city of Baltimore, MD, use the `glm` function to fit a logistic
regression with resolved vs unresolved as the outcome and victim age,
sex and race as predictors. Save the output of `glm` as an R object;
apply the `broom::tidy` to this object; and obtain the estimate and
confidence interval of the adjusted **odds ratio** for solving homicides
comparing male victims to female victims keeping all other variables
fixed.

``` r
baltimore_logistic = homicide_data |> 
  filter(city_state == "Baltimore, MD") |>
  glm(solved ~ victim_age + victim_sex + victim_race, data = _, family = binomial()) 

baltimore_logistic |>
  broom::tidy(conf.int = TRUE) |>
  mutate(OR = exp(estimate)) |>
  select(term, log_OR = estimate, OR, p.value, conf.low, conf.high) |> 
  knitr::kable(digits = 3)
```

| term             | log_OR |    OR | p.value | conf.low | conf.high |
|:-----------------|-------:|------:|--------:|---------:|----------:|
| (Intercept)      |  0.310 | 1.363 |   0.070 |   -0.025 |     0.648 |
| victim_age       | -0.007 | 0.993 |   0.043 |   -0.013 |     0.000 |
| victim_sexMale   | -0.854 | 0.426 |   0.000 |   -1.126 |    -0.584 |
| victim_raceWhite |  0.842 | 2.320 |   0.000 |    0.501 |     1.187 |

Homicides with male victims are less likely to be solved than those with
female victims.

## City-wise GLM

Now run `glm` for each of the cities in your dataset, and extract the
adjusted odds ratio (and CI) for solving homicides comparing male
victims to female victims. Do this within a “tidy” pipeline, making use
of `purrr::map`, list columns, and `unnest` as necessary to create a
dataframe with estimated ORs and CIs for each city.

``` r
city_logistic = homicide_data |>
  nest(data = -city_state) |>
  mutate(glm = map(data, \(data) glm(solved ~ victim_sex + victim_race + victim_age,  
                                     data = data) |>
                     broom::tidy(conf.int=TRUE))) |>
  unnest(glm) |>
  mutate(OR = exp(estimate)) |>
  select(city_state, term, OR, p.value, conf.low, conf.high) |>
  filter(term %in% c("victim_sex","victim_sexMale","victim_sexFemale"))

city_logistic |>
  knitr::kable()
```

| city_state         | term           |        OR |   p.value |   conf.low |  conf.high |
|:-------------------|:---------------|----------:|----------:|-----------:|-----------:|
| Albuquerque, NM    | victim_sexMale | 1.1390712 | 0.1314781 | -0.0381730 |  0.2985993 |
| Atlanta, GA        | victim_sexMale | 1.0005193 | 0.9908724 | -0.0884014 |  0.0894397 |
| Baltimore, MD      | victim_sexMale | 0.8157365 | 0.0000000 | -0.2662316 | -0.1410963 |
| Baton Rouge, LA    | victim_sexMale | 0.8022543 | 0.0013271 | -0.3539181 | -0.0867412 |
| Birmingham, AL     | victim_sexMale | 0.9669546 | 0.5133899 | -0.1343294 |  0.0671220 |
| Boston, MA         | victim_sexMale | 0.9243657 | 0.2594040 | -0.2151667 |  0.0578717 |
| Buffalo, NY        | victim_sexMale | 0.8586506 | 0.0266457 | -0.2867125 | -0.0180738 |
| Charlotte, NC      | victim_sexMale | 0.9769660 | 0.6039922 | -0.1113139 |  0.0647071 |
| Chicago, IL        | victim_sexMale | 0.8217273 | 0.0000000 | -0.2384406 | -0.1542529 |
| Cincinnati, OH     | victim_sexMale | 0.8249529 | 0.0006495 | -0.3025121 | -0.0823458 |
| Columbus, OH       | victim_sexMale | 0.8566020 | 0.0002636 | -0.2376334 | -0.0719304 |
| Denver, CO         | victim_sexMale | 0.8381536 | 0.0396375 | -0.3436593 | -0.0094486 |
| Detroit, MI        | victim_sexMale | 0.8755806 | 0.0000036 | -0.1889734 | -0.0767627 |
| Durham, NC         | victim_sexMale | 0.9550185 | 0.5807926 | -0.2091392 |  0.1170900 |
| Fort Worth, TX     | victim_sexMale | 0.9102630 | 0.1346385 | -0.2169351 |  0.0288917 |
| Fresno, CA         | victim_sexMale | 1.0631507 | 0.5004335 | -0.1165739 |  0.2390476 |
| Houston, TX        | victim_sexMale | 0.9193087 | 0.0058386 | -0.1438816 | -0.0243850 |
| Indianapolis, IN   | victim_sexMale | 0.9806640 | 0.5958691 | -0.0916648 |  0.0526140 |
| Jacksonville, FL   | victim_sexMale | 0.9223401 | 0.0283084 | -0.1529999 | -0.0086825 |
| Las Vegas, NV      | victim_sexMale | 0.9601634 | 0.2811234 | -0.1145325 |  0.0332288 |
| Long Beach, CA     | victim_sexMale | 0.8375926 | 0.0705089 | -0.3681492 |  0.0137024 |
| Los Angeles, CA    | victim_sexMale | 0.9049770 | 0.0281853 | -0.1888889 | -0.0108027 |
| Louisville, KY     | victim_sexMale | 0.8543645 | 0.0033942 | -0.2622374 | -0.0525573 |
| Memphis, TN        | victim_sexMale | 0.9377110 | 0.0460370 | -0.1274402 | -0.0011867 |
| Miami, FL          | victim_sexMale | 0.8549934 | 0.0123405 | -0.2788485 | -0.0344746 |
| Milwaukee, wI      | victim_sexMale | 0.9319241 | 0.0996980 | -0.1543611 |  0.0133532 |
| Minneapolis, MN    | victim_sexMale | 0.9869343 | 0.8789956 | -0.1823214 |  0.1560176 |
| Nashville, TN      | victim_sexMale | 1.0079105 | 0.8722794 | -0.0881489 |  0.1039076 |
| New Orleans, LA    | victim_sexMale | 0.8814679 | 0.0010145 | -0.2012426 | -0.0510908 |
| New York, NY       | victim_sexMale | 0.7637459 | 0.0000183 | -0.3913653 | -0.1476751 |
| Oakland, CA        | victim_sexMale | 0.8745391 | 0.0095911 | -0.2352311 | -0.0328853 |
| Oklahoma City, OK  | victim_sexMale | 0.9935634 | 0.9084310 | -0.1164403 |  0.1035254 |
| Omaha, NE          | victim_sexMale | 0.8400995 | 0.0037434 | -0.2912565 | -0.0572134 |
| Philadelphia, PA   | victim_sexMale | 0.8516025 | 0.0000004 | -0.2225559 | -0.0987148 |
| Pittsburgh, PA     | victim_sexMale | 0.8235901 | 0.0005886 | -0.3041896 | -0.0839751 |
| Richmond, VA       | victim_sexMale | 1.0025804 | 0.9715362 | -0.1388618 |  0.1440160 |
| San Antonio, TX    | victim_sexMale | 0.9219496 | 0.2320853 | -0.2142842 |  0.0517548 |
| Sacramento, CA     | victim_sexMale | 0.9162242 | 0.2615604 | -0.2398613 |  0.0648729 |
| Savannah, GA       | victim_sexMale | 0.9657366 | 0.7010863 | -0.2126489 |  0.1429206 |
| San Bernardino, CA | victim_sexMale | 0.8459249 | 0.2001555 | -0.4221720 |  0.0875226 |
| San Diego, CA      | victim_sexMale | 0.8405635 | 0.0167423 | -0.3150708 | -0.0322947 |
| San Francisco, CA  | victim_sexMale | 0.9005776 | 0.1454915 | -0.2454786 |  0.0360408 |
| St. Louis, MO      | victim_sexMale | 0.9166148 | 0.0141616 | -0.1565572 | -0.0175787 |
| Stockton, CA       | victim_sexMale | 1.0747297 | 0.4522380 | -0.1154518 |  0.2595901 |
| Tampa, FL          | victim_sexMale | 0.9491292 | 0.6229995 | -0.2599956 |  0.1555748 |
| Tulsa, OK          | victim_sexMale | 0.9951681 | 0.9234718 | -0.1036202 |  0.0939329 |
| Washington, DC     | victim_sexMale | 0.9151561 | 0.0598747 | -0.1809246 |  0.0036032 |

## Plot OR and CIs

Create a plot that shows the estimated ORs and CIs for each city.
Organize cities according to estimated OR, and comment on the plot.
